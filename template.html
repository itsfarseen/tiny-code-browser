<!DOCTYPE html>
<html>

<head>
	<title>{{.AppTitle}}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg-color: #f8f9fa;
			--container-bg: white;
			--text-color: #333;
			--header-bg: #343a40;
			--header-text: white;
			--border-color: #ddd;
			--hover-bg: #f8f9fa;
			--code-bg: #f8f9fa;
			--code-border: #e9ecef;
			--secondary-text: #6c757d;
			--button-bg: #6c757d;
			--button-hover: #5a6268;
			--font-size: 13px;
		}

		[data-theme="dark"] {
			--bg-color: #1a1a1a;
			--container-bg: #2d2d2d;
			--text-color: #e0e0e0;
			--header-bg: #1f1f1f;
			--header-text: #e0e0e0;
			--border-color: #404040;
			--hover-bg: #3a3a3a;
			--code-bg: #1e1e1e;
			--code-border: #404040;
			--secondary-text: #a0a0a0;
			--button-bg: #555;
			--button-hover: #666;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, sans-serif;
			margin: 0;
			padding: 0;
			background: var(--bg-color);
			color: var(--text-color);
			transition: background 0.3s, color 0.3s;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			background: var(--container-bg);
			overflow: hidden;
			min-height: 100vh;
			transition: background 0.3s;
		}

		.header {
			background: var(--header-bg);
			color: var(--header-text);
			padding: 15px 20px;
			border-bottom: 1px solid var(--border-color);
			display: flex;
			justify-content: space-between;
			align-items: center;
			transition: background 0.3s, border-color 0.3s;
		}

		.header-left {
			display: flex;
			align-items: center;
			gap: 15px;
		}

		.header-left h2 {
			margin: 0;
		}

		.header-right {
			display: flex;
			align-items: stretch;
			gap: 10px;
		}

		.path {
			font-family: 'JetBrains Mono', monospace;
			font-size: 14px;
			color: var(--secondary-text);
			word-break: break-all;
			transition: color 0.3s;
			text-overflow: ellipsis;
		}

		.header-button {
			background: var(--button-bg);
			color: var(--header-text);
			border: none;
			padding: 8px 12px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 14px;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			transition: background 0.3s;
		}

		.header-button:hover {
			background: var(--button-hover);
		}

		.font-controls {
			display: flex;
			gap: 5px;
		}

		.font-btn {
			background: var(--button-bg);
			color: var(--header-text);
			border: none;
			padding: 6px 10px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 12px;
			transition: background 0.3s;
		}

		.font-btn:hover {
			background: var(--button-hover);
		}

		.content {
			padding: 0 20px;
		}

		.file-list {
			list-style: none;
			padding: 0;
			margin: 0;
		}

		.file-item {
			display: flex;
			align-items: center;
			padding: 12px 15px;
			border-bottom: 1px solid var(--border-color);
			text-decoration: none;
			color: var(--text-color);
			transition: background 0.15s, border-color 0.3s, color 0.3s;
			min-height: 44px;
		}

		.file-item:hover {
			background: var(--hover-bg);
		}

		.file-icon {
			margin-right: 8px;
			width: 16px;
			text-align: center;
		}

		.file-name {
			flex: 1;
			font-family: 'JetBrains Mono', monospace;
			font-size: 14px;
		}

		.file-size {
			color: var(--secondary-text);
			font-size: 12px;
			font-family: 'JetBrains Mono', monospace;
			transition: color 0.3s;
		}

		.code-content {
			background: var(--code-bg);
			border-top: 1px solid var(--code-border);
			border-bottom: 1px solid var(--code-border);
			padding: 20px;
			font-family: 'JetBrains Mono', monospace;
			font-size: var(--font-size);
			line-height: 1.5;
			white-space: pre;
			overflow-x: auto;
			overflow-y: auto;
			color: var(--text-color);
			margin: 0 -20px;
			transition: background 0.3s, border-color 0.3s, color 0.3s, font-size 0.2s;
		}

		.code-content.word-wrap-enabled {
			white-space: pre-wrap;
			word-wrap: break-word;
		}

		.back-button {
			display: inline-block;
			padding: 4px 16px;
			background: var(--button-bg);
			color: var(--header-text);
			text-decoration: none;
			border-radius: 4px;
			font-size: 14px;
			transition: background 0.3s;
			display: inline-flex;
			align-items: center;
			flex-shrink: 0;
		}

		.back-button:hover {
			background: var(--button-hover);
		}

		.error {
			color: #dc3545;
			background: #f8d7da;
			padding: 10px;
			border-radius: 4px;
			margin: 10px 0;
		}

		.path-container {
			display: flex;
			gap: 1em;
			align-items: center;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header">
			<div class="header-left">
				<h2>{{.AppTitle}}</h2>
			</div>
			<div class="header-right">
				{{if .IsFile}}
				<div class="font-controls">
					<button class="font-btn" onclick="changeFontSize(-1)">A-</button>
					<button class="font-btn" onclick="changeFontSize(1)">A+</button>
				</div>
				<button class="header-button" id="word-wrap-button">W&gt;</button>
				{{end}}
				<button class="header-button" onclick="toggleTheme()">üåô</button>
			</div>
		</div>
		<div class="content">
			<div class="path-container">
				<h3>{{.CurrentPath}}</h3>
				{{if ne .CurrentPath ""}}
				<a href="/browse/{{.CurrentPath | dirname}}" class="back-button">
					&lt;&lt; Back</a>
				{{end}}
			</div>
			{{if .IsFile}}
			<div class="code-content">{{.Content}}</div>
			{{else}}
			<ul class="file-list">
				{{range .Files}}
				<li>
					<a href="/browse{{.Path}}" class="file-item">
						<span class="file-icon">{{if .IsDir}}üìÅ{{else}}üìÑ{{end}}</span>
						<span class="file-name">{{.Name}}</span>
						{{if not .IsDir}}
						<span class="file-size">{{.Size}} bytes</span>
						{{end}}
					</a>
				</li>
				{{end}}
			</ul>
			{{end}}
		</div>
	</div>

	<script>
		function toggleTheme() {
			const body = document.body;
			const button = document.querySelector('.header-button');

			if (body.getAttribute('data-theme') === 'dark') {
				body.removeAttribute('data-theme');
				button.textContent = 'üåô';
				localStorage.setItem('theme', 'light');
			} else {
				body.setAttribute('data-theme', 'dark');
				button.textContent = '‚òÄÔ∏è';
				localStorage.setItem('theme', 'dark');
			}
		}

		function changeFontSize(delta) {
			const root = document.documentElement;
			const currentSize = parseInt(getComputedStyle(root).getPropertyValue('--font-size'));
			const newSize = Math.max(5, Math.min(32, currentSize + delta));
			root.style.setProperty('--font-size', newSize + 'px');
			localStorage.setItem('fontSize', newSize);
		}

		// Apply saved theme and font size on page load
		document.addEventListener('DOMContentLoaded', function () {
			const savedTheme = localStorage.getItem('theme');
			const button = document.querySelector('.header-button');

			if (savedTheme === 'dark') {
				document.body.setAttribute('data-theme', 'dark');
				button.textContent = '‚òÄÔ∏è';
			}

			const savedFontSize = localStorage.getItem('fontSize');
			if (savedFontSize) {
				document.documentElement.style.setProperty('--font-size', savedFontSize + 'px');
			}

			const wordWrapButton = document.getElementById('word-wrap-button');
			const codeContent = document.querySelector('.code-content'); // Use querySelector for class

			function updateWordWrapState(isEnabled) {
				if (codeContent) {
					if (isEnabled) {
						codeContent.classList.add('word-wrap-enabled');
					} else {
						codeContent.classList.remove('word-wrap-enabled');
					}
				}
				if (wordWrapButton) {
					wordWrapButton.textContent = isEnabled ? 'W<' : 'W>';
				}
				localStorage.setItem('wordWrapEnabled', isEnabled ? 'true' : 'false');
			}

			// Load saved state from localStorage
			const savedWordWrapState = localStorage.getItem('wordWrapEnabled');
			const initialWordWrapEnabled = savedWordWrapState === 'true';
			updateWordWrapState(initialWordWrapEnabled);


			if (wordWrapButton) { // Only add listener if button exists
				wordWrapButton.addEventListener('click', () => {
					const currentWordWrapEnabled = codeContent.classList.contains('word-wrap-enabled');
					updateWordWrapState(!currentWordWrapEnabled);
				});
			}
		});
	</script>
</body>

</html>
